/**
 * Hook Generator
 * Generates hook files
 */

import { existsSync, mkdirSync, writeFileSync } from 'fs';
import { join } from 'path';
import { toKebabCase, toCamelCase } from '../utils/file-utils.js';

export async function generateHook(name, options = {}) {
  const cwd = process.cwd();
  const kebabName = toKebabCase(name);
  const camelName = toCamelCase(name);
  const hookDir = join(cwd, 'src', 'hooks', kebabName);

  console.log(`Generating hook: use${camelName.charAt(0).toUpperCase() + camelName.slice(1)}`);

  // Create directory
  if (!existsSync(hookDir)) {
    mkdirSync(hookDir, { recursive: true });
  }

  // Generate hook file
  const hookContent = generateHookFile(camelName, kebabName);
  writeFileSync(join(hookDir, `use-${kebabName}.mycelia.js`), hookContent);

  // Generate validation file
  const validationContent = generateValidationFile(camelName, kebabName);
  writeFileSync(join(hookDir, `${kebabName}.validation.mycelia.js`), validationContent);

  console.log(`âœ… Hook generated: ${hookDir}`);
}

function generateHookFile(camelName, kebabName) {
  const pascalHookName = camelName.charAt(0).toUpperCase() + camelName.slice(1);
  
  return `/**
 * use${pascalHookName} Hook
 * Generated by mycelia-kernel CLI
 */

import { createHook } from '../../mycelia-kernel-v2/hooks/create-hook.mycelia.js';
import { Facet } from '../../mycelia-kernel-v2/models/facet-manager/facet.mycelia.js';
import { validate${pascalHookName} } from './${kebabName}.validation.mycelia.js';

export const use${pascalHookName} = createHook({
  kind: '${kebabName}',
  overwrite: false,
  required: [],
  attach: true,
  source: import.meta.url,
  contract: null,
  fn: (ctx, api, subsystem) => {
    const { name } = api;
    const config = ctx.config?.${kebabName} || {};

    // Validate configuration
    validate${pascalHookName}(config);

    const facet = new Facet('${kebabName}', { attach: true, source: import.meta.url }).add({
      // TODO: Add facet methods
    });

    return facet;
  }
});
`;
}

function generateValidationFile(camelName, kebabName) {
  const pascalHookName = camelName.charAt(0).toUpperCase() + camelName.slice(1);
  
  return `/**
 * Validation utilities for ${kebabName} hook
 * Generated by mycelia-kernel CLI
 */

/**
 * Validate ${kebabName} hook configuration
 * @param {Object} config - Hook configuration
 * @throws {Error} If configuration is invalid
 */
export function validate${pascalHookName}(config) {
  if (!config || typeof config !== 'object') {
    throw new Error('${pascalHookName}: config must be an object');
  }
  // TODO: Add validation logic
}

/**
 * Validate ${kebabName} hook options
 * @param {Object} options - Hook options
 * @throws {Error} If options are invalid
 */
export function validate${pascalHookName}Options(options) {
  if (!options || typeof options !== 'object') {
    throw new Error('${pascalHookName}: options must be an object');
  }
  // TODO: Add validation logic
}
`;
}




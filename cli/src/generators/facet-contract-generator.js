/**
 * Facet Contract Generator
 * Generates facet contract files
 */

import { existsSync, mkdirSync, writeFileSync } from 'fs';
import { join } from 'path';
import { toKebabCase, toPascalCase } from '../utils/file-utils.js';

export async function generateFacetContract(name, options = {}) {
  const cwd = process.cwd();
  const kebabName = toKebabCase(name);
  const pascalName = toPascalCase(name);
  const contractDir = join(cwd, 'src', 'facet-contracts', kebabName);

  console.log(`Generating facet contract: ${pascalName}Contract`);

  // Create directory
  if (!existsSync(contractDir)) {
    mkdirSync(contractDir, { recursive: true });
  }

  // Generate contract file
  const contractContent = generateContractFile(pascalName, kebabName);
  writeFileSync(join(contractDir, `${kebabName}.contract.mycelia.js`), contractContent);

  // Generate validation file
  const validationContent = generateValidationFile(pascalName, kebabName);
  writeFileSync(join(contractDir, `${kebabName}.validation.mycelia.js`), validationContent);

  // Generate example adapter if requested
  if (options.withExample) {
    const adapterContent = generateExampleAdapter(pascalName, kebabName);
    writeFileSync(join(contractDir, `${kebabName}.adapter.example.mycelia.js`), adapterContent);
  }

  console.log(`âœ… Facet contract generated: ${contractDir}`);
}

function generateContractFile(pascalName, kebabName) {
  return `/**
 * ${pascalName}Contract
 * Generated by mycelia-kernel CLI
 */

import { FacetContract } from '../../mycelia-kernel-v2/models/facet-contract/facet-contract.mycelia.js';
import { validate${pascalName}Contract } from './${kebabName}.validation.mycelia.js';

export const ${pascalName}Contract = new FacetContract({
  name: '${kebabName}',
  // TODO: Define contract requirements
  requiredMethods: [
    // 'method1',
    // 'method2'
  ],
  validate: (adapter) => {
    validate${pascalName}Contract(adapter);
    return true;
  }
});
`;
}

function generateValidationFile(pascalName, kebabName) {
  return `/**
 * Validation utilities for ${kebabName} contract
 * Generated by mycelia-kernel CLI
 */

/**
 * Validate ${kebabName} contract adapter
 * @param {Object} adapter - Contract adapter implementation
 * @throws {Error} If adapter does not implement contract
 */
export function validate${pascalName}Contract(adapter) {
  if (!adapter || typeof adapter !== 'object') {
    throw new Error('${pascalName}Contract: adapter must be an object');
  }
  // TODO: Add validation logic for required methods
}

/**
 * Validate ${kebabName} contract methods
 * @param {Object} methods - Methods to validate
 * @throws {Error} If required methods are missing
 */
export function validate${pascalName}ContractMethods(methods) {
  if (!methods || typeof methods !== 'object') {
    throw new Error('${pascalName}Contract: methods must be an object');
  }
  // TODO: Add validation logic
}
`;
}

function generateExampleAdapter(pascalName, kebabName) {
  return `/**
 * Example adapter for ${pascalName}Contract
 * Generated by mycelia-kernel CLI
 */

import { ${pascalName}Contract } from './${kebabName}.contract.mycelia.js';

/**
 * Example adapter implementation
 * This is a template - implement according to your contract requirements
 */
export class Example${pascalName}Adapter {
  constructor(options = {}) {
    this.options = options;
  }

  // TODO: Implement contract methods
}
`;
}



